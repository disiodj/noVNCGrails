{"version":3,"sources":["events.js"],"names":["getPointerEvent","e","changedTouches","touches","stopEvent","stopPropagation","preventDefault","_captureRecursion","_elementForUnflushedEvents","document","captureElement","_captureProxy","newEv","constructor","type","dispatchEvent","defaultPrevented","releaseCapture","_capturedElemChanged","proxyElem","getElementById","style","cursor","window","getComputedStyle","_captureObserver","MutationObserver","setCapture","target","createElement","id","position","top","left","width","height","zIndex","display","body","appendChild","addEventListener","observe","attributes","disconnect","removeEventListener"],"mappings":"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","sourcesContent":["/*\r\n * noVNC: HTML5 VNC client\r\n * Copyright (C) 2018 The noVNC Authors\r\n * Licensed under MPL 2.0 (see LICENSE.txt)\r\n *\r\n * See README.md for usage and integration instructions.\r\n */\r\n\r\n/*\r\n * Cross-browser event and position routines\r\n */\r\n\r\nexport function getPointerEvent(e) {\r\n    return e.changedTouches ? e.changedTouches[0] : e.touches ? e.touches[0] : e;\r\n}\r\n\r\nexport function stopEvent(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n}\r\n\r\n// Emulate Element.setCapture() when not supported\r\nlet _captureRecursion = false;\r\nlet _elementForUnflushedEvents = null;\r\ndocument.captureElement = null;\r\nfunction _captureProxy(e) {\r\n    // Recursion protection as we'll see our own event\r\n    if (_captureRecursion) return;\r\n\r\n    // Clone the event as we cannot dispatch an already dispatched event\r\n    const newEv = new e.constructor(e.type, e);\r\n\r\n    _captureRecursion = true;\r\n    if (document.captureElement) {\r\n        document.captureElement.dispatchEvent(newEv);\r\n    } else {\r\n        _elementForUnflushedEvents.dispatchEvent(newEv);\r\n    }\r\n    _captureRecursion = false;\r\n\r\n    // Avoid double events\r\n    e.stopPropagation();\r\n\r\n    // Respect the wishes of the redirected event handlers\r\n    if (newEv.defaultPrevented) {\r\n        e.preventDefault();\r\n    }\r\n\r\n    // Implicitly release the capture on button release\r\n    if (e.type === \"mouseup\") {\r\n        releaseCapture();\r\n    }\r\n}\r\n\r\n// Follow cursor style of target element\r\nfunction _capturedElemChanged() {\r\n    const proxyElem = document.getElementById(\"noVNC_mouse_capture_elem\");\r\n    proxyElem.style.cursor = window.getComputedStyle(document.captureElement).cursor;\r\n}\r\n\r\nconst _captureObserver = new MutationObserver(_capturedElemChanged);\r\n\r\nexport function setCapture(target) {\r\n    if (target.setCapture) {\r\n\r\n        target.setCapture();\r\n        document.captureElement = target;\r\n    } else {\r\n        // Release any existing capture in case this method is\r\n        // called multiple times without coordination\r\n        releaseCapture();\r\n\r\n        let proxyElem = document.getElementById(\"noVNC_mouse_capture_elem\");\r\n\r\n        if (proxyElem === null) {\r\n            proxyElem = document.createElement(\"div\");\r\n            proxyElem.id = \"noVNC_mouse_capture_elem\";\r\n            proxyElem.style.position = \"fixed\";\r\n            proxyElem.style.top = \"0px\";\r\n            proxyElem.style.left = \"0px\";\r\n            proxyElem.style.width = \"100%\";\r\n            proxyElem.style.height = \"100%\";\r\n            proxyElem.style.zIndex = 10000;\r\n            proxyElem.style.display = \"none\";\r\n            document.body.appendChild(proxyElem);\r\n\r\n            // This is to make sure callers don't get confused by having\r\n            // our blocking element as the target\r\n            proxyElem.addEventListener('contextmenu', _captureProxy);\r\n\r\n            proxyElem.addEventListener('mousemove', _captureProxy);\r\n            proxyElem.addEventListener('mouseup', _captureProxy);\r\n        }\r\n\r\n        document.captureElement = target;\r\n\r\n        // Track cursor and get initial cursor\r\n        _captureObserver.observe(target, {attributes: true});\r\n        _capturedElemChanged();\r\n\r\n        proxyElem.style.display = \"\";\r\n\r\n        // We listen to events on window in order to keep tracking if it\r\n        // happens to leave the viewport\r\n        window.addEventListener('mousemove', _captureProxy);\r\n        window.addEventListener('mouseup', _captureProxy);\r\n    }\r\n}\r\n\r\nexport function releaseCapture() {\r\n    if (document.releaseCapture) {\r\n\r\n        document.releaseCapture();\r\n        document.captureElement = null;\r\n\r\n    } else {\r\n        if (!document.captureElement) {\r\n            return;\r\n        }\r\n\r\n        // There might be events already queued. The event proxy needs\r\n        // access to the captured element for these queued events.\r\n        // E.g. contextmenu (right-click) in Microsoft Edge\r\n        //\r\n        // Before removing the capturedElem pointer we save it to a\r\n        // temporary variable that the unflushed events can use.\r\n        _elementForUnflushedEvents = document.captureElement;\r\n        document.captureElement = null;\r\n\r\n        _captureObserver.disconnect();\r\n\r\n        const proxyElem = document.getElementById(\"noVNC_mouse_capture_elem\");\r\n        proxyElem.style.display = \"none\";\r\n\r\n        window.removeEventListener('mousemove', _captureProxy);\r\n        window.removeEventListener('mouseup', _captureProxy);\r\n    }\r\n}\r\n"]}